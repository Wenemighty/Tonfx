# File: tonfx_bot.py
import requests
from telegram import Update, ReplyKeyboardMarkup, ReplyKeyboardRemove
from telegram.ext import Updater, CommandHandler, MessageHandler, Filters, CallbackContext

# Replace with your bot token
BOT_TOKEN = '7554460064:AAEAy6Y2SIrKPry26fVyzm3STcfwLEbsHqc'
CHANNEL_USERNAME = '@wenefx'  # Replace with your channel username

# Function to check if a user is in the channel
def is_user_in_channel(user_id: int) -> bool:
    url = f"https://api.telegram.org/bot{BOT_TOKEN}/getChatMember?chat_id={CHANNEL_USERNAME}&user_id={user_id}"
    response = requests.get(url).json()
    status = response.get("result", {}).get("status", "")
    return status in ["member", "administrator", "creator"]

# Start command handler
def start(update: Update, context: CallbackContext) -> None:
    user_id = update.effective_user.id

    if not is_user_in_channel(user_id):
        update.message.reply_text(
            f"ğŸš¨ You must join our channel {CHANNEL_USERNAME} to use this bot.\n\n"
            "ğŸ‘‰ [Click to Join Channel](https://t.me/wenefx)\n\n"
            "After joining, type /start again.",
            parse_mode="Markdown",
            disable_web_page_preview=True
        )
        return

    # Welcome message and menu
    keyboard = [
        ["ğŸ’µ Withdraw", "ğŸ Daily Bonus"],
        ["Earn More", "ğŸ’° Balance", "ğŸ”— Referral"]
    ]
    reply_markup = ReplyKeyboardMarkup(keyboard, resize_keyboard=True)
    update.message.reply_text(
        "ğŸ‰ Welcome to TonFX Bot!\n\n"
        "ğŸ“Œ Use the menu below to navigate.",
        reply_markup=reply_markup
    )

# Menu handlers
def withdraw(update: Update, context: CallbackContext) -> None:
    update.message.reply_text("ğŸ’µ Withdraw: Feature coming soon!")

def daily_bonus(update: Update, context: CallbackContext) -> None:
    update.message.reply_text("ğŸ Daily Bonus: Claim your bonus here!")

def earn_more(update: Update, context: CallbackContext) -> None:
    update.message.reply_text("ğŸ“ˆ Earn More: Learn how to earn more with TonFX.")

def balance(update: Update, context: CallbackContext) -> None:
    update.message.reply_text("ğŸ’° Balance: Check your balance here!")

def referral(update: Update, context: CallbackContext) -> None:
    user_id = update.effective_user.id
    referral_link = f"https://t.me/{context.bot.username}?start={user_id}"
    update.message.reply_text(f"ğŸ”— Referral Link: Share this link to earn rewards!\n\n{referral_link}")

# Main function to run the bot
def main():
    updater = Updater(BOT_TOKEN)

    # Dispatcher to handle commands and messages
    dispatcher = updater.dispatcher

    # Commands
    dispatcher.add_handler(CommandHandler("start", start))
    dispatcher.add_handler(MessageHandler(Filters.regex("ğŸ’µ Withdraw"), withdraw))
    dispatcher.add_handler(MessageHandler(Filters.regex("ğŸ Daily Bonus"), daily_bonus))
    dispatcher.add_handler(MessageHandler(Filters.regex("Earn More"), earn_more))
    dispatcher.add_handler(MessageHandler(Filters.regex("ğŸ’° Balance"), balance))
    dispatcher.add_handler(MessageHandler(Filters.regex("ğŸ”— Referral"), referral))

    # Start polling for updates
    updater.start_polling()
    updater.idle()

if __name__ == "__main__":
    main()
